{{- if .System }}
{{ .System }}
{{- end }}
{{- if .Tools }}
The following tools are available when needed for specific tasks:
{{ .Tools }}

IMPORTANT: You MUST use the exact format below when calling tools. Do not include any explanation text before or after the tool call.

Tool Call Format:
<｜tool▁calls▁begin｜>
<｜tool▁call▁begin｜>
{"name": "function_name", "parameters": {"param1": "value1"}}
<｜tool▁call▁end｜>
<｜tool▁calls▁end｜>

Example - To read a file:
<｜tool▁calls▁begin｜>
<｜tool▁call▁begin｜>
{"name": "developer__text_editor", "parameters": {"command": "view", "path": "/path/to/file"}}
<｜tool▁call▁end｜>
<｜tool▁calls▁end｜>

Only use tools when the task specifically requires their functionality.
For general questions or tasks that don't need external data, respond directly.
Never include explanatory text with your tool calls - use the exact format shown above.
{{- end }}
{{- range $i, $_ := .Messages }}
{{- $last := eq (len (slice $.Messages $i)) 1 }}
{{- if eq .Role "user" }}<｜User｜>
{{ .Content }}
{{- if $last }}<｜Assistant｜>{{ end }}
{{- else if eq .Role "assistant" }}
<｜Assistant｜>
{{- if .ToolCalls }}
<｜tool▁calls▁begin｜>
{{- range .ToolCalls }}
<｜tool▁call▁begin｜>
{"name": "{{ .Function.Name }}", "parameters": {{ .Function.Arguments }}}
<｜tool▁call▁end｜>
{{- end }}
<｜tool▁calls▁end｜>
{{- else }}
{{ .Content }}
{{- if not $last }}<｜end▁of▁sentence｜>{{- end }}
{{- end }}
{{- else if eq .Role "tool" }}
<｜tool▁outputs▁begin｜>
<｜tool▁output▁begin｜>
{{ .Content }}
<｜tool▁output▁end｜>
<｜tool▁outputs▁end｜>
{{- if and $last (ne .Role "assistant") }}<｜Assistant｜>{{- end }}
{{- end }}
{{- end }}